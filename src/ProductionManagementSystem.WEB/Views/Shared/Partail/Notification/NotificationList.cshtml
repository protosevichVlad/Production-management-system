@using ProductionManagementSystem.Core.Models.AltiumDB
@using ProductionManagementSystem.Core.Models.Users

<aside class="bx--panel--overlay" id="switcher-bqavcareoq" data-product-switcher="" tabindex="-1">
  <div class="bx--product-switcher">
    <p class="bx--product-switcher__subheader">To Do</p>
    <ul class="bx--product-switcher__product-list">
      @foreach (var toDo in (ViewBag.ToDos as List<ToDoNote>)?.Where(x => User.IsInRole(RoleEnum.AltiumDBTablesAdmin) || x.Completed == false) ?? new List<ToDoNote>())
      {
        <li class="bx--product-list__item">
          <div class="bx--product-link" tabindex="0">
            @if (toDo.Completed)
            {
              <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" fill="#42be65" class="bx--product-switcher__icon bx--navigation-menu-panel-expand-icon" width="32" height="32" viewBox="0 0 32 32">
                <defs>
                  <style>
                    .cls-1 {
                      fill: none;
                    }
                  </style>
                </defs>
                <polygon points="13 24 4 15 5.414 13.586 13 21.171 26.586 7.586 28 9 13 24"/>
                <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
              </svg>
            }
            else
            {
              <div class="bx--product-switcher__icon">
                <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="#f1c21b" viewBox="0 0 32 32" aria-hidden="true">
                  <defs>
                    <style>.cls-1{fill:none;}</style>
                  </defs><title>warning</title><path d="M16,2A14,14,0,1,0,30,16,14,14,0,0,0,16,2Zm0,26A12,12,0,1,1,28,16,12,12,0,0,1,16,28Z" transform="translate(0 0)"/><rect x="15" y="8" width="2" height="11"/><path d="M16,22a1.5,1.5,0,1,0,1.5,1.5A1.5,1.5,0,0,0,16,22Z" transform="translate(0 0)"/><rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
                </svg>
              </div>
            }
            <div class="bx--grid">
              <div class="bx--row">
                <span class="bx--product-link__name">@toDo.Title</span>
              </div>
              @if (toDo?.CreatedBy?.UserName != null)
              {
                <div class="bx--row altiumdb--notes-list--date">
                  Created by @toDo.CreatedBy.UserName (@toDo.CreatedDateTime.ToString("dd.MM.yyyy"))
                </div>
              }
              @if (toDo?.CompletedBy?.UserName != null)
              {
                <div class="bx--row altiumdb--notes-list--date">
                  Complited by @toDo.CompletedBy.UserName (@toDo.CompletedDateTime.ToString("dd.MM.yyyy"))
                </div>
              }
            </div>
            
          </div>
          @if (User.IsInRole(RoleEnum.AltiumDBTablesAdmin) && !toDo.Completed)
          {
            <div data-overflow-menu="" tabindex="0" aria-label="Overflow menu description" class="bx--overflow-menu">
              <svg width="3" height="15" viewBox="0 0 3 15">
                <path d="M0 1.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 1 1-3 0M0 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 1 1-3 0M0 13.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 1 1-3 0"></path>
              </svg>
              <ul class="bx--overflow-menu-options bx--overflow-menu--flip" tabindex="-1" data-floating-menu-direction="bottom">
                <li class="bx--overflow-menu-options__option bx--overflow__item">
                  <button class="bx--overflow-menu-options__btn" title="Completed" onclick="markNoteAsCompleted(@toDo.Id)">Completed</button>
                </li>
                <li class="bx--overflow-menu-options__option bx--overflow__item">
                  <button class="bx--overflow-menu-options__btn" title="Completed" onclick="deleteNote(@toDo.Id)">Delete</button>
                </li>
              </ul>
            </div>
          }
        </li>
      }
    </ul>
  </div>
</aside>