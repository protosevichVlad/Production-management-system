@using ProductionManagementSystem.Core.Models.Users
@using ProductionManagementSystem.Core.Models.AltiumDB
@using System.Globalization

@{
  DateTime lastOpened = DateTime.Now;
  DateTime.TryParseExact(Context.Request.Cookies["AltiumDB_Notifications_LastOpened"], "dd/MM/yyyy_HH:mm:ss", CultureInfo.InvariantCulture, DateTimeStyles.None, out lastOpened);

}

<!DOCTYPE html>
<html lang="ru">
<head>
  <title>@ViewData["Title"] - AltiumDB</title>
  <script type="text/javascript" src="~/js/vue.global.js"></script>
  <script src="~/lib/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="~/js/carbon-components.min.js"></script>
  <link rel="stylesheet" href="~/css/carbon-components.min.css"/>
  <link rel="stylesheet" href="~/css/AltiumDB/site.css"/>
  <link rel="stylesheet" href="/components/TreeView/treeViewComponent.css"/>
  <script type="text/javascript" src="~/js/AltiumDB/site.js"></script>
  @RenderSection("Stylesheet", required: false);
</head>
<body>
<header class="bx--header" role="banner" aria-label="IBM Platform Name" data-header>
  <a class="bx--header__menu-item" asp-controller="AltiumDB" asp-action="Index" tabindex="0">AltiumDB</a>
  <nav class="bx--header__nav" aria-label="Platform Name" data-header-nav>
    <ul class="bx--header__menu-bar" aria-label="Platform Name">
      <li>
        <a class="bx--header__menu-item" asp-area="" asp-controller="AltiumDB" asp-action="Tables" tabindex="0">
          Tables
        </a>
      </li>
      <li>
        <a class="bx--header__menu-item" asp-area="AltiumDB" asp-controller="Projects" asp-action="Index" tabindex="0">
          Projects
        </a>
      </li>
      @* <li> *@
      @*   <a class="bx--header__menu-item" asp-controller="AltiumDB" asp-action="Directories" tabindex="0"> *@
      @*     Directories setting *@
      @*   </a> *@
      @* </li> *@
    </ul>
  </nav>
  <div class="bx--header__global">
    <button class="bx--header__menu-trigger bx--header__action" aria-label="Action 1" title="Action 1" data-navigation-menu-panel-label-expand="Action 1" data-navigation-menu-panel-label-collapse="Close menu" data-product-switcher-target="#switcher-bqavcareoq" onclick="document.cookie = `AltiumDB_Notifications_LastOpened=${getDateTime()}; path=/; expires=Fri, 31 Dec 9999 23:59:59 GMT;`">
      @if (ViewBag.ToDos != null && (ViewBag.ToDos as List<ToDoNote>)?.Count > 0 && lastOpened <= (ViewBag.ToDos as List<ToDoNote>)?[0].Created ?? false)
      {
        <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="bx--navigation-menu-panel-expand-icon" width="20" height="20" viewBox="0 0 32 32">
          <defs>
            <style>
            .cls-1 {
              fill: none;
            }
          </style>
          </defs>
          <path d="M26,16.5859V14H24v3a1,1,0,0,0,.293.707L27,20.4141V22H5V20.4141L7.707,17.707A1,1,0,0,0,8,17V13A7.9854,7.9854,0,0,1,20,6.0825V3.8467a9.896,9.896,0,0,0-3-.7959V1H15V3.0508A10.0136,10.0136,0,0,0,6,13v3.5859L3.293,19.293A1,1,0,0,0,3,20v3a1,1,0,0,0,1,1h7v1a5,5,0,0,0,10,0V24h7a1,1,0,0,0,1-1V20a1,1,0,0,0-.293-.707ZM19,25a3,3,0,0,1-6,0V24h6Z"/>
          <circle cx="26" cy="8" r="4"/>
          <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
        </svg>
      }
      else
      {
        <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="bx--navigation-menu-panel-expand-icon" width="20" height="20" viewBox="0 0 32 32">
          <defs>
            <style>.cls-1 {fill: none;}</style>
          </defs>
          <path d="M28.7071,19.293,26,16.5859V13a10.0136,10.0136,0,0,0-9-9.9492V1H15V3.0508A10.0136,10.0136,0,0,0,6,13v3.5859L3.2929,19.293A1,1,0,0,0,3,20v3a1,1,0,0,0,1,1h7v.7768a5.152,5.152,0,0,0,4.5,5.1987A5.0057,5.0057,0,0,0,21,25V24h7a1,1,0,0,0,1-1V20A1,1,0,0,0,28.7071,19.293ZM19,25a3,3,0,0,1-6,0V24h6Zm8-3H5V20.4141L7.707,17.707A1,1,0,0,0,8,17V13a8,8,0,0,1,16,0v4a1,1,0,0,0,.293.707L27,20.4141Z"/>
          <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
        </svg>
      }
      <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="bx--navigation-menu-panel-collapse-icon" width="20" height="20" viewBox="0 0 32 32">
        <path d="M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"></path>
      </svg>
    </button>
  </div>
</header>
<aside class="bx--panel--overlay" id="switcher-bqavcareoq" data-product-switcher="" tabindex="-1">
  <div class="bx--product-switcher">
    <p class="bx--product-switcher__subheader">To Do</p>
    <ul class="bx--product-switcher__product-list">
      @foreach (var toDo in (ViewBag.ToDos as List<ToDoNote>)?.Where(x => User.IsInRole(RoleEnum.AltiumDBTablesAdmin) || x.Completed == false) ?? new List<ToDoNote>())
      {
        <li class="bx--product-list__item">
          <a class="bx--product-link" tabindex="0" href="javascript:void(0)">
            @if (toDo.Completed)
            {
              <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" fill="#42be65" class="bx--product-switcher__icon bx--navigation-menu-panel-expand-icon" width="32" height="32" viewBox="0 0 32 32">
                <defs>
                  <style>
                    .cls-1 {
                      fill: none;
                    }
                  </style>
                </defs>
                <polygon points="13 24 4 15 5.414 13.586 13 21.171 26.586 7.586 28 9 13 24"/>
                <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
              </svg>
            }
            else
            {
              <div class="bx--product-switcher__icon">
                <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="#f1c21b" viewBox="0 0 32 32" aria-hidden="true">
                  <defs>
                    <style>.cls-1{fill:none;}</style>
                  </defs><title>warning</title><path d="M16,2A14,14,0,1,0,30,16,14,14,0,0,0,16,2Zm0,26A12,12,0,1,1,28,16,12,12,0,0,1,16,28Z" transform="translate(0 0)"/><rect x="15" y="8" width="2" height="11"/><path d="M16,22a1.5,1.5,0,1,0,1.5,1.5A1.5,1.5,0,0,0,16,22Z" transform="translate(0 0)"/><rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
                </svg>
              </div>
            }
            <span class="bx--product-link__name">@toDo.Title</span>
          </a>
          @if (User.IsInRole(RoleEnum.AltiumDBTablesAdmin) && !toDo.Completed)
          {
            <div data-overflow-menu="" tabindex="0" aria-label="Overflow menu description" class="bx--overflow-menu">
              <svg width="3" height="15" viewBox="0 0 3 15">
                <path d="M0 1.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 1 1-3 0M0 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 1 1-3 0M0 13.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 1 1-3 0"></path>
              </svg>
              <ul class="bx--overflow-menu-options bx--overflow-menu--flip" tabindex="-1" data-floating-menu-direction="bottom">
                <li class="bx--overflow-menu-options__option bx--overflow__item">
                  <button class="bx--overflow-menu-options__btn" title="Completed" onclick="markNoteAsCompleted(@toDo.Id)">Completed</button>
                </li>
              </ul>
            </div>
          }
        </li>
      }
    </ul>
  </div>
</aside>
<div class="bx--content">
  @RenderBody()
</div>
<div data-modal id="modal-danger" class="bx--modal bx--modal--danger" role="dialog"
     aria-modal="true" aria-labelledby="modal-danger-label" aria-describedby="modal-danger-heading" tabindex="-1">
  <div class="bx--modal-container">
    <div class="bx--modal-header">
      <p class="bx--modal-header__label bx--type-delta" id="modal-danger-label"></p>
      <p class="bx--modal-header__heading bx--type-beta" id="modal-danger-heading"></p>
      <button class="bx--modal-close" type="button" data-modal-close aria-label="close modal">
        <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" class="bx--modal-close__icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
          <path d="M12 4.7L11.3 4 8 7.3 4.7 4 4 4.7 7.3 8 4 11.3 4.7 12 8 8.7 11.3 12 12 11.3 8.7 8z"></path>
        </svg>
      </button>
    </div>

    <!-- Note: Modals with content that scrolls, at any viewport, requires `tabindex="0"` on the `bx--modal-content` element -->

    <div class="bx--modal-content">
      <p id="modal-danger-text"></p>
    </div>
    <div class="bx--modal-footer">
      <button class="bx--btn bx--btn--secondary" type="button" data-modal-close>Cancel</button>
      <button class="bx--btn bx--btn--danger" type="button" id="modal-danger-delete-button" aria-label="Danger" data-modal-close>Delete</button>
    </div>
  </div>
  <span tabindex="0"></span>
</div>
<script src="/components/TreeView/treeViewComponent.js"></script>
@await RenderSectionAsync("Scripts", false)
</body>
</html>