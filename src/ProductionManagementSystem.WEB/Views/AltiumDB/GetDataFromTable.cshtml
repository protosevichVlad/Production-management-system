@model ProductionManagementSystem.WEB.Models.AltiumDB.DataListViewModel

@{
  ViewBag.Title = @Model.DatabaseTable.DisplayName;
  Layout = "Shared/_AltiumDBLayout";
}

@{
    string GetOrderUrl(string name)
    {
      if (Context.Request.QueryString.Value != null)
      {
        if (Context.Request.QueryString.Value.Contains("orderBy"))
        {
          if (IsActive(name))
          {
            if (IsDesc(name))
              return Context.Request.Path.Value + Context.Request.QueryString.Value
                .Replace($"orderBy={Context.Request.Query.FirstOrDefault(x => x.Key == "orderBy").Value.ToString().Replace(" ", "%20")}", "");
            return Context.Request.Path.Value + Context.Request.QueryString.Value.Replace($"orderBy={Context.Request.Query.FirstOrDefault(x => x.Key == "orderBy").Value.ToString().Replace(" ", "%20")}", $"orderBy={name}_desc");
          }
            return Context.Request.Path.Value + Context.Request.QueryString.Value.Replace($"orderBy={Context.Request.Query.FirstOrDefault(x => x.Key == "orderBy").Value.ToString().Replace(" ", "%20")}", $"orderBy={name}");
        }
        return Context.Request.Path.Value + Context.Request.QueryString.Value + $"{(Context.Request.Query.Count > 0 ? "&" : "?")}orderBy={name}";
      }

      return "";
    }

  bool IsActive(string name)
  {
    if (Context.Request.Query.Keys.Contains("orderBy"))
    {
      return Context.Request.Query.FirstOrDefault(x => x.Key == "orderBy").Value.ToString().Contains(name);
    }
    return false;
  }

  bool IsDesc(string name)
  {
    return Context.Request.Query.FirstOrDefault(x => x.Key == "orderBy").Value.ToString().Contains("_desc");
  }

  string GetClassByColumnName(string name)
  {
    if (!IsActive(name))
      return "";

    if (IsDesc(name))
      return "bx--table-sort--active";
    return "bx--table-sort--active bx--table-sort--ascending";
  }
}

<div class="bx--data-table-container " data-table>
  <div class="bx--data-table-header">
    <div class="bx--grid--full-width">
      <div class="bx--row">
        <div class="bx--col-lg-2">
          <h4 class="bx--data-table-header__title">@Model.DatabaseTable.DisplayName</h4>
          <p class="bx--data-table-header__description">Optional Helper Text</p>
        </div>
        <div class="bx--col-lg-10">
          <form method="get" action="">
          <div class="bx--grid">
            <div class="bx--row">
              @foreach (var filter in Model.Filters)
              {
                <div class="bx--col-lg-2">
                  <fieldset class="bx--fieldset" style="max-height: 200px; overflow: auto">
                    <legend class="bx--label">@filter.FilterName</legend>
                    @foreach (var value in filter.Values)
                    {
                      <div class="bx--form-item bx--checkbox-wrapper">
                        <input id="bx--checkbox-@filter.FilterName-@value.value" class="bx--checkbox" type="checkbox" value="@value.value"
                               name="@filter.FilterName" @(value.selected ? "checked":"")>
                        <label for="bx--checkbox-@filter.FilterName-@value.value" class="bx--checkbox-label">@value.value</label>
                      </div>
                    }
                  </fieldset>
                </div>
              }
            </div>
            <div class="bx--row">
              <div class="bx--col-lg-3 bx--offset-lg-8 bx--tooltip--align-end">
                <button
                  class="bx--btn bx--btn--tertiary bx--btn--sm"
                  type="button" onclick="location.href ='@Model.DatabaseTable.TableName'">
                  Reset All
                </button>
                <button
                   class="bx--btn bx--btn--tertiary bx--btn--sm"
                    type="submit">
                   Apply filters
                 </button>  
              </div>
            </div>
          </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <section class="bx--table-toolbar  bx--table-toolbar--small ">

    <div class="bx--toolbar-content">
      <!--  Default hidden search -->
      <div class="bx--toolbar-search-container-expandable">
        <div data-search class="bx--search bx--search--sm" role="search">
          <div class="bx--search-magnifier" tabindex="0">
            <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" class="bx--toolbar-action__icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
              <path d="M15,14.3L10.7,10c1.9-2.3,1.6-5.8-0.7-7.7S4.2,0.7,2.3,3S0.7,8.8,3,10.7c2,1.7,5,1.7,7,0l4.3,4.3L15,14.3z M2,6.5	C2,4,4,2,6.5,2S11,4,11,6.5S9,11,6.5,11S2,9,2,6.5z"></path>
            </svg>
          </div>
          <label id="search-input-label-1" class="bx--label" for="search__input-2">Search</label>
          <input class="bx--search-input" type="text" id="search__input-2" role="search" placeholder="Search" aria-labelledby="search-input-label-1">
          <button class="bx--search-close bx--search-close--hidden" title="Clear search input" aria-label="Clear search input">
            <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
              <path d="M12 4.7L11.3 4 8 7.3 4.7 4 4 4.7 7.3 8 4 11.3 4.7 12 8 8.7 11.3 12 12 11.3 8.7 8z"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Persistent Search -->

      <!-- Toolbar Overflow Menu -->
      <div class="bx--overflow-menu bx--toolbar-action" data-overflow-menu role="button" tabindex="0" aria-label="Overflow" aria-haspopup="true"
           aria-expanded="false">
        <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" class="bx--toolbar-action__icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
          <path d="M13.5,8.4c0-0.1,0-0.3,0-0.4c0-0.1,0-0.3,0-0.4l1-0.8c0.4-0.3,0.4-0.9,0.2-1.3l-1.2-2C13.3,3.2,13,3,12.6,3	c-0.1,0-0.2,0-0.3,0.1l-1.2,0.4c-0.2-0.1-0.4-0.3-0.7-0.4l-0.3-1.3C10.1,1.3,9.7,1,9.2,1H6.8c-0.5,0-0.9,0.3-1,0.8L5.6,3.1	C5.3,3.2,5.1,3.3,4.9,3.4L3.7,3C3.6,3,3.5,3,3.4,3C3,3,2.7,3.2,2.5,3.5l-1.2,2C1.1,5.9,1.2,6.4,1.6,6.8l0.9,0.9c0,0.1,0,0.3,0,0.4	c0,0.1,0,0.3,0,0.4L1.6,9.2c-0.4,0.3-0.5,0.9-0.2,1.3l1.2,2C2.7,12.8,3,13,3.4,13c0.1,0,0.2,0,0.3-0.1l1.2-0.4	c0.2,0.1,0.4,0.3,0.7,0.4l0.3,1.3c0.1,0.5,0.5,0.8,1,0.8h2.4c0.5,0,0.9-0.3,1-0.8l0.3-1.3c0.2-0.1,0.4-0.2,0.7-0.4l1.2,0.4	c0.1,0,0.2,0.1,0.3,0.1c0.4,0,0.7-0.2,0.9-0.5l1.1-2c0.2-0.4,0.2-0.9-0.2-1.3L13.5,8.4z M12.6,12l-1.7-0.6c-0.4,0.3-0.9,0.6-1.4,0.8	L9.2,14H6.8l-0.4-1.8c-0.5-0.2-0.9-0.5-1.4-0.8L3.4,12l-1.2-2l1.4-1.2c-0.1-0.5-0.1-1.1,0-1.6L2.2,6l1.2-2l1.7,0.6	C5.5,4.2,6,4,6.5,3.8L6.8,2h2.4l0.4,1.8c0.5,0.2,0.9,0.5,1.4,0.8L12.6,4l1.2,2l-1.4,1.2c0.1,0.5,0.1,1.1,0,1.6l1.4,1.2L12.6,12z"></path><path d="M8,11c-1.7,0-3-1.3-3-3s1.3-3,3-3s3,1.3,3,3C11,9.6,9.7,11,8,11C8,11,8,11,8,11z M8,6C6.9,6,6,6.8,6,7.9C6,7.9,6,8,6,8	c0,1.1,0.8,2,1.9,2c0,0,0.1,0,0.1,0c1.1,0,2-0.8,2-1.9c0,0,0-0.1,0-0.1C10,6.9,9.2,6,8,6C8.1,6,8,6,8,6z"></path>
        </svg>
        <ul class="bx--overflow-menu-options bx--overflow-menu--flip" tabindex="-1" role="menu" aria-label="Overflow" data-floating-menu-direction="bottom">
          <li class="bx--overflow-menu-options__option " role="presentation">
            <button class="bx--overflow-menu-options__btn" role="menuitem" onclick="location.href='/AltiumDB/EditTable/@Model.DatabaseTable.TableName'">
              <div class="bx--overflow-menu-options__option-content">
                Edit table
              </div>
            </button>
          </li>
        </ul>
      </div>

      <!--  Toolbar primary button -->
      <button class="bx--btn bx--btn--sm bx--btn--primary" onclick="location.href='@Model.DatabaseTable.TableName/CreateEntity'">
        Add entity
        <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" class="bx--btn__icon" width="20" height="20" viewBox="0 0 32 32" aria-hidden="true">
          <path d="M17 15L17 7 15 7 15 15 7 15 7 17 15 17 15 25 17 25 17 17 25 17 25 15 17 15z"></path>
        </svg>
      </button>
    </div>
  </section>
  <!-- End Toolbar Content -->
<!-- Table -->
<table class="bx--data-table  bx--data-table--sort bx--data-table--visible-overflow-menu bx--data-table--compact">
  <thead>
  <tr>
    <th></th>
    @foreach (var columnName in Model.DatabaseTable.TableColumns.Where(x => x.Display).Select(x => x.ColumnName))
    {
      <!-- checkbox th -->
      <th>
        <!-- sortable th  -->
        <button class="bx--table-sort @GetClassByColumnName(columnName)" data-event="sort" title="@columnName" onclick="location.href='@GetOrderUrl(columnName)'">
          <span class="bx--table-header-label">@columnName</span>
          <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" class="bx--table-sort__icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
            <path d="M12.3 9.3L8.5 13.1 8.5 1 7.5 1 7.5 13.1 3.7 9.3 3 10 8 15 13 10z"></path>
          </svg>
          <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" class="bx--table-sort__icon-unsorted" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
            <path d="M13.8 10.3L12 12.1 12 2 11 2 11 12.1 9.2 10.3 8.5 11 11.5 14 14.5 11zM4.5 2L1.5 5 2.2 5.7 4 3.9 4 14 5 14 5 3.9 6.8 5.7 7.5 5z"></path>
          </svg>
        </button>
        <!-- no sort th -->
      </th>
    }
    <th style="width: 30px"></th>
  </tr>
  </thead>
  <tbody>
  @for (int i = 0; i < Model.Data.Count; i++)
  {
    <tr >
      <td>
        <img src="@Model.Data[i].ImageLink" class="altiumdb--entity-table--image"/>
      </td>

      @foreach (var columnName in Model.DatabaseTable.TableColumns.Where(x => x.Display).Select(x => x.ColumnName))
      {
        <td>
          @if (columnName == "Part Number")
          {
            <a href="/AltiumDB/Tables/@Model.DatabaseTable.TableName/@Model.Data[i]["Part Number"]">@Model.Data[i][columnName]</a>
          }
          else if (columnName == "ImageLink")
          {
            <img src="@Model.Data[i][columnName]"/>
          }
          else
          {
            <span style="white-space: pre-line">@Model.Data[i][columnName].ToString()</span>
          }
        </td>
      }
      <!-- expand icon td -->
      <td class="bx--table-column-menu">
        <div data-overflow-menu role="menu" tabindex="0" aria-label="Overflow menu description" class="bx--overflow-menu">
          <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" class="bx--overflow-menu__icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
            <circle cx="8" cy="3" r="1"></circle><circle cx="8" cy="8" r="1"></circle><circle cx="8" cy="13" r="1"></circle>
          </svg>
          <ul class="bx--overflow-menu-options bx--overflow-menu--flip">

            <li class="bx--overflow-menu-options__option bx--table-row--menu-option">
              <button class="bx--overflow-menu-options__btn" onclick="location.href='/AltiumDB/Tables/@Model.DatabaseTable.TableName/EditEntity/@Model.Data[i]["Part Number"]'">
                <div class="bx--overflow-menu-options__option-content">
                  <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M1 13H15V14H1zM12.7 4.5c.4-.4.4-1 0-1.4 0 0 0 0 0 0l-1.8-1.8c-.4-.4-1-.4-1.4 0 0 0 0 0 0 0L2 8.8V12h3.2L12.7 4.5zM10.2 2L12 3.8l-1.5 1.5L8.7 3.5 10.2 2zM3 11V9.2l5-5L9.8 6l-5 5H3z"></path>
                  </svg> Edit
                </div>
              </button>
            </li>
            <li class="bx--overflow-menu-options__option bx--table-row--menu-option">
              <button class="bx--overflow-menu-options__btn" data-modal-target="#modal-danger" onclick="showDeleteModal('Deleting an entity', 'Do you really want to delete this entity', () => deleteEntityFromTable('@Model.DatabaseTable.TableName', '@Model.Data[i]["Part Number"]'))">
                <div class="bx--overflow-menu-options__option-content">
                  <svg focusable="false" preserveAspectRatio="xMidYMid meet" style="will-change: transform;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M6 6H7V12H6zM9 6H10V12H9z"></path><path d="M2 3v1h1v10c0 .6.4 1 1 1h8c.6 0 1-.4 1-1V4h1V3H2zM4 14V4h8v10H4zM6 1H10V2H6z"></path>
                  </svg> Delete
                </div>
              </button>
            </li>

          </ul>
        </div>
      </td>
      <!-- inline edit tds -->
    </tr>
  }
  <!-- Expandable child row -->
  </tbody>
</table>
</div>

<!-- Pagination -->